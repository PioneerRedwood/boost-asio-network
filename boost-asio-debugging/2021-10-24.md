# 2021-10-24 디버깅 일지

2021-10-22 일지에서 ... 목표를 완수하지 못해 넘어왔다.

새로운 네임스페이스 ban::prototype

1차 목표: 

- 매칭 서버는 로그인 된 클라이언트의 목록을 덱으로 관리한다.

- 2개의 클라이언트는 로그인이 된 상태로 매칭에 등록한다. 

## matchmaking system #2

#### 용어 설명

매치

- 멀티플레이어에서 발생하는 전투 세션을 말한다.

매치 메이킹

- 서버에서 매치를 만드는 알고리즘과 그 과정을 모두 말한다.
- 클라이언트에서는 매치 메이킹에 관해서 알 수 없도록 은닉해야 한다.

로비

- 클라이언트가 로그인한 상태에서 접속하게 되는 가상의 공간이다.
- 대부분의 게임에서는 여기서 플레이어 간 채팅을 나누는 등의 상호작용이 가능하다.



문제점이 발생했던 부분을 저번 디버깅 일지에는 적지 않아서 여기서 설명하려고 한다.

매칭 서버에서는 로그인이 된 클라이언트만이 로비에 접속할 수 있다. 로비에 접속한다는 것은 매칭 서버에 TCP 소켓 연결이 활성화된 것과 같다. 빠르게 프로토타입을 완성하기 위해 로그인을 처음에 바로 수행한 상태에서 시작한다. 

#### 클라이언트

클라이언트는 로그인(로비에만 있는 상태), 매칭 시작, 매칭 수락, 입장 대기의 상태를 가질 수 있다. 

``` C++
enum class client_status
{
	IDLE,				// 유휴(기본) 상태
	LOGGED_IN, 			// 로그인 - 매칭 시작 메시지 전송 가능
	MATCHING_STARTED,	// 매칭 시작함
	MATCHING_FOUND,		// 매칭 찾음 - 매칭 수락 메시지 전송 가능
	READY_BATTLE,		// 배틀 서버 생성 대기 중 ...
};
```

로그인 상태에서만 매칭 시작을 전송할 수 있으며 매칭 수락은 매칭을 찾았다는 서버로부터의 응답이 있어야 전송이 가능하다. 입장 대기 상태는 서버가 배틀 서버를 동적으로 생성한 뒤 입장이 가능한 상태에 대한 메시지를 전송하고 이를 받기 전까지의 상태이다. 이때 아무키나 누르면 동적으로 생성된 배틀 서버에 대한 클라이언트 입장이 시작된다. 

클라이언트 플랫폼이 정해져 있지 않아서 현재로선 콘솔에서 키보드 숫자(1, 2, 3, 4, 5 등)의 키를 통해 메시지를 전송 가능하다. 이 입력 핸들에 대한 함수는 클라이언트 인스턴스 내 스레드로 동작하고 있다.

#### 서버

현재 서버는 2개의 클라이언트가 매칭을 시작하면 매칭을 찾았다는 메시지를 두 클라이언트에 보내고 클라이언트로부터 매칭 수락이 오면 배틀 서버를 동적으로 생성한다. 

현재 이 동적으로 배틀 서버를 생성(?) 아직 고민 중

- 서버 인스턴스 내에서 작동하는 또다른 TCP 혹은 UDP 네트워크 서버 인스턴스를 생성
- 동일한 호스트 PC내에 만들어져있는 개별 서버들에 대한 연결(접속) 정보 - 예를 들어, IP 주소, 포트 등- 를 클라이언트에게 전달하는 방식도 가능하다. 



우선 프로토타입은 여기까지 만들었다.

실제 매치메이킹이 원활하게 작동하기 위해서는 매칭해주는 기준이 필요하다. 유저의 티어 같은 요소 말이다. 이에 대해선 게임을 구체적으로 구현할 때 고려해야 한다.

