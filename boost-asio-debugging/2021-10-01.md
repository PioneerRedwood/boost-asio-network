## 2021-10-01 #4

##### 2021-09-30 #3-1 ë¬¸ì œì  ë””ë²„ê¹… 

í™•ì‹¤í•˜ì§€ ì•Šìœ¼ë‚˜ ì—¬ëŸ¬ê°€ì§€ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ê³  ë””ë²„ê¹…í•œ ê²°ê³¼ .. ì´ê²¬ì´ ìƒê¸¸ ê²½ìš° ì¶”ê°€í•  ì˜ˆì •

```C++
async_read(socket_, boost::asio::buffer(read_buffer_),        
    // connection ì¸ìŠ¤í„´ìŠ¤ì˜ ë‚´ìš©ë§Œ ì°¸ê³ í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— shared_ptrëŠ” í•„ìš” ì—†ìŒ
    // ì˜ë¬¸ì . ìµœì í™”ë©´ì—ì„œ connection ì¸ìŠ¤í„´ìŠ¤ì˜ ë³µì‚¬ëŠ” ë¹„íš¨ìœ¨ì ì´ë‹¤. 
    // ë§Œì•½ ì°¸ì¡°ë¡œ shared_ptrëœ ê±¸ ë„˜ê¸°ë©´ ë³´ë‹¤ íš¨ìœ¨ì ì¼ê¹Œ?
	[this](const err& error, size_t bytes)->size_t
	{
		if (error) { return 0; }
		bool found = std::find(read_buffer_, read_buffer_ + bytes, '\n') < read_buffer_ + bytes;
		return found ? 0 : 1;
	},
    // lambda captureì— ì‹ì„ ì¶”ê°€í•´ì„œ shared_ptr ì „ë‹¬
	[this, self = std::move(this->shared_from_this())](const err& error, size_t bytes)->void
	{
		if (!started_) { return; }
		if (error)
		{
			std::cout << "[ERROR] async_read\n" << error.message() << "\n";
			return;
		}
		std::string msg(read_buffer_, bytes);
        // shared ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•œ ë¶€ë¶„
		self->on_message(msg);
	});
```

ë§Œì•½ thisë¥¼ ì¸ìë¡œ ë„˜ê¸°ë©´ connectionì„ ë³µì‚¬ ìƒì„±ì„ í•˜ê²Œ ë˜ê³  shared_ptrì˜ ê°•í•œ ì°¸ì¡° íšŸìˆ˜(strong reference count)ë¥¼ ì¦ê°€ì‹œí‚¤ì§€ ì•Šê³  ì•½í•œ ì°¸ì¡° íšŸìˆ˜(weak reference count)ë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤. shared ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•œ ë¶€ë¶„ì¸ self->on_message(msg)ì—ì„œëŠ” ë³µì‚¬ ìƒì„±í•œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ë‹ˆë¼ ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•´ì•¼ í•œë‹¤. 

ì¶”ì‹ 

- ìœ„ ì„¤ëª…ì´ ë§¤ë„ëŸ½ì§€ ì•Šì€ë° ì •í™•í•œ ì´ìœ ë¥¼ ëª¨ë¥´ê² ë‹¤. ê·¸ì € ì—ëŸ¬ê°€ ë°œìƒí•œ ë¶€ë¶„ìœ¼ë¡œë¶€í„°ì˜ ì¶”ì¸¡ì¼ ë¿ì´ë‹¤.

- ì§§ì€ ì˜ì–´ë¡œ stackoverflowì— [ë¬¸ì˜](https://stackoverflow.com/questions/69400540/c-boost-asio-network-in-async-callback-which-one-is-better-using-lambda-or/69400604#69400604)ë¥¼ ì˜¬ë¦¬ê³  ìŠ¤ìŠ¤ë¡œ ë‹µí–ˆë‹¤. ğŸ¤¦â€â™‚ï¸

  - comment ì¤‘ shared_ptrë¥¼ std::move í•  í•„ìš”ê°€ ì—†ë‹¤ê³  í–ˆë‹¤. ì´ëŠ” std::moveë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì— ëŒ€í•´ì„œ ì˜¤í•´í•˜ê³  ìˆì—ˆë˜ ê²ƒì´ ìˆì—ˆë‹¤. std::moveëŠ” ì‚¬ì‹¤ìƒ ìºìŠ¤íŒ…í•˜ëŠ” ì‘ì—…ì´ë©° í•´ë‹¹ ë§¥ë½ì—ì„œëŠ” ì“°ì¼ ì´ìœ ê°€ ì „í˜€ ì—†ì—ˆë‹¤.

  - ```C++
    // FUNCTION TEMPLATE move
    template <class _Ty>
    _NODISCARD constexpr remove_reference_t<_Ty>&& move(_Ty&& _Arg) noexcept { // forward _Arg as movable
        return static_cast<remove_reference_t<_Ty>&&>(_Arg);
    }
    ```

#### ë¬¸ì œì  #1

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì ‘ì†í•œ ë’¤ í†µì‹  ì¤‘ ê°‘ì‘ìŠ¤ëŸ½ê²Œ ì ‘ì†ì´ ì¢…ë£Œëœë‹¤.
